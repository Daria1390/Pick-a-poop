<!DOCTYPE html>
<html>

	<head>
		<script type="text/javascript" src="leaflet.js"></script>
		<script type="text/javascript" src="jquery-2.2.4.js"></script>
		<script type="text/javascript" src="bootstrap.min.js"></script>

		<link rel="stylesheet" href="leaflet.css" />
		<link rel="stylesheet" href="bootstrap.min.css" />
		<link rel="stylesheet" href="style.css" />

		<meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />

		<title>Pick-a-Poop</title>

        <script>
        	window.twttr = (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0],
                t = window.twttr || {};
                if (d.getElementById(id)) return t;
                js = d.createElement(s);
                js.id = id;
                js.src = "https://platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);

                t._e = [];
                t.ready = function(f) {
                	t._e.push(f);
                };

                return t;
            }(document, "script", "twitter-wjs"));
        </script>

	</head>
	<body>
		<a href="https://github.com/Pick-a-Poop/Pick-a-poop" target="_blank"><img id="GHLink" style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/8b6b8ccc6da3aa5722903da7b58eb5ab1081adee/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png"></a>
		<center>

			<a href="https://www.youtube.com/watch?v=_Y2HITTEu4Q&feature=youtu.be"; target = "_blank" data-toggle="tooltip" title="Click the logo to see more about this project!"><img id="topImg" src="square_logo.png"></a>

			<h1 id="topTitle">Pick-a-Poop!</h1>

			<div class="btn-group" id="topBtn">
				<div class="btn-group" id="topBtn">
	    			<button type="button" class="btn btn-link btn-primary dropdown-toggle" data-toggle="dropdown" id="topBtn"><p style="font-size: 40px">+</p></button>
	    			<ul class="dropdown-menu pull-right" role="menu">
	      				<li><a href="#" onclick="message()"> + Marker </a></li>
	      				<li><a href="mailto:info@pick-a-poop.dog"> <span class="glyphicon glyphicon-envelope"></span> Contact </a></li>
	      				<li><a href="https://twitter.com/Pick_a_Poop" target="_blank"> Twitter </a></li>
	    			</ul>
	  			</div>
	  		</div>

			<h3>Find the nearest dog poop bag dispenser to YOU in Luxembourg</h3>

		</center>

		<div id="map">
			<script>
				var map = L.map('map').setView([49.61, 6.1333], 16);
	                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);

	                        // Do a Geo lookup and center map
	                        map.locate({setView: true, maxZoom: 16});


				var dogLogo = L.icon({
	    			iconUrl: 'square_logo.png',
	   				iconSize:     [40, 40],
	   				iconAnchor:   [20, 20], 
	   				popupAnchor:  [0, 0] 
				});
				var str = "49.6056053,6.1004009;49.6022481,6.0982424;49.6104174,6.1119808;49.6099997,6.1218942;49.6100161,6.1220134;49.6103494,6.1243939;49.6103116,6.1241225;49.6090174,6.1250375;49.6079218,6.1228634;49.6123914,6.12414;49.589837,6.1175615;49.5921938,6.1183518;49.5927927,6.1188725;49.5917464,6.1208063;49.5912428,6.1248775;49.6126031,6.111646;49.6122027,6.1082617;49.610022,6.0511328;49.6184751,6.1206244;49.6191907,6.1213109;49.6197357,6.1202553;49.6225103,6.1231566;49.621265,6.1237135;49.6294245,6.1697575;49.625581,6.1363995;49.6098083,6.107633;49.6104256,6.1119266;49.608593,6.107973;49.607352,6.111066;49.610207,6.124201;49.607245,6.128171;49.606894,6.128071;49.605270,6.129439;49.606422,6.110144;49.605726,6.110882;49.609110,6.112134;49.608165,6.106820;49.599919,6.131281;49.603628,6.118409;49.6206753,6.1108967;49.6105542,6.1318758;49.6100987,6.1321436;49.604894,6.1316549;49.6051431,6.1283401;49.6044622,6.129023;49.6113354,6.1209189;49.610561,6.107538";
				var res = str.split(";");
				var lons = [];
				var lats = [];
				for (var i = 0; i < res.length; i++) {
					var res2 = res[i].split(",");
					lons.push(res2[0]);
					lats.push(res2[1]);
				}
				var marker = [];
				for (var i = 0; i <= lats.length-1; i++) {
				  marker[i] = L.marker([lons[i], lats[i]], {icon: dogLogo}).addTo(map);
				}

				var IWBHLogo = L.icon({
	    			iconUrl: 'GOC_logo.png',
	   				iconSize:     [40, 40],
	   				iconAnchor:   [20, 20], 
	   				popupAnchor:  [0, 0] 
				});
				var IWBH = L.marker([49.600511, 6.113653], {icon: IWBHLogo}).addTo(map);
				var popupTextIWBH = "Pick-a-Poop was born here " + '<a href="https://twitter.com/Gameofcode_lu" target="_blank">@Gameofcode_lu</a>';
				IWBH.bindPopup(popupTextIWBH);

				var CDLogo = L.icon({
	    			iconUrl: 'CD_logo.png',
	   				iconSize:     [25, 25],
	   				iconAnchor:   [20, 20], 
	   				popupAnchor:  [0, 0] 
				});
				var CoderDojo = L.marker([49.591602, 6.140687], {icon: CDLogo}).addTo(map);
				var popupTextCD = '<a href="https://twitter.com/coderdojolu" target="_blank">CoderDojoLu</a>';
				CoderDojo.bindPopup(popupTextCD);

				function toggleText(statusdivindex) {
	                var dispenserstatus = document.getElementById("dispenserstatus"+statusdivindex);
	                var newtext = '';
	                if(dispenserstatus.innerHTML == 'EMPTY'){
	                    newtext = 'FULL';
	                } else {
	                    newtext = 'EMPTY';
	                }
	                marker[statusdivindex].bindPopup("<div id='dispenserstatus"+statusdivindex+"'>"+newtext+"</div><input type='button' value='Toggle' onclick='toggleText("+statusdivindex+")' />").openPopup();
	            }

	            for (var i = 0; i <= marker.length-1; i++) {
	                marker[i].bindPopup("<div id='dispenserstatus"+i+"'>FULL</div><input type='button' value='Toggle' onclick='toggleText("+i+")' />");
	            }

	            function newDis() {
	                console.log("Add-button pressed, locating...");

	                var output = document.getElementById("btm1");

	                if (!navigator.geolocation){
	                    console.log("No geolocation available!");
	                }      

	                function success(position) {
	                    console.log("Geolocation success, adding marker...");                        
	                    var latitude  = position.coords.latitude;
	                    var longitude = position.coords.longitude;
	                    newAddedMarker = marker.length;

	                    var newMarkerIcon = L.icon({
	                        iconUrl: 'newMarker.png',
	                        iconSize:     [40, 40],
	                        iconAnchor:   [20, 20], 
	                        popupAnchor:  [0, 0] 
	                    });

	                    marker[newAddedMarker] = L.marker([latitude, longitude, {icon: newMarkerIcon}]).addTo(map).bindPopup("<div id='dispenserstatus"+newAddedMarker+"'>FULL</div><input type='button' value='Toggle' onclick='toggleText("+newAddedMarker+")' />");

	                    console.log("Added marker to " + latitude + ", " + longitude);

	                };

	                function error() {
	                    console.log("Couldn't get geolocation!");
	                }; 

	                navigator.geolocation.getCurrentPosition(success, error);
	            }

	            function message() {
	                alert("This function is not fully implemented yet. Please report a missing dispenser by using 'Contact the Team'-button.");

	            };

    		</script>
		</div>

		<br>

		<center>
			 <div class="btn-group btn-group-justified" id="btmBtn">

  				<a href="#" class="btn btn-primary" onclick="message()" id="btmBtn"> Add new Marker </a>
  				
  				<a href="mailto:info@pick-a-poop.dog" class="btn btn-primary" id="btmBtn"> <span class="glyphicon glyphicon-envelope"></span> Contact our Team </a>

	      		<a href="https://twitter.com/Pick_a_Poop" class="btn btn-primary" target="_blank" id="btmBtn"> @Pick-a-Poop on Twitter </a>
			</div>
		</center>

    </body>
</html>
